version: '2'
services:
  build:
    image: agneta-build
    build:
      context: .
    volumes:
      - .:/home/app
    working_dir: /home/app
    command: agneta image build -m portal
  portal:
    domainname: '<%-config.domain.portal%>'
    hostname: '<%-config.domain.portal%>'
    image: '<%-config.image%>'
    build:
      context: .
    environment:
      - NODE_ENV=production
      - MODE=portal
      - HOST_NAME=<%-config.domain.portal%>
      - ENDPOINT=https://<%-config.domain.portal%>
      - PORT_HTTP=<%-config.portHttp.portal%>
      - PORT=<%-config.port.portal%>
    ports:
      - '80:<%-config.portHttp.portal%>'
      - '443:<%-config.port.portal%>'
  services:
    domainname: '<%-config.domain.services%>'
    hostname: '<%-config.domain.services%>'
    image: '<%-config.image%>'
    build:
      context: .
    environment:
      - NODE_ENV=production
      - MODE=services
      - HOST_NAME=<%-config.domain.services%>
      - ENDPOINT=https://<%-config.domain.services%>
      - PORT_HTTP=<%-config.portHttp.services%>
      - PORT=<%-config.port.services%>
    ports:
      - '80:<%-config.portHttp.services%>'
      - '443:<%-config.port.services%>'
  pages:
    domainname: '<%-config.domain.pages%>'
    hostname: '<%-config.domain.pages%>'
    image: '<%-config.image%>'
    build:
      context: .
    environment:
      - NODE_ENV=production
      - MODE=pages
      - HOST_NAME=<%-config.domain.pages%>
      - ENDPOINT=https://<%-config.domain.pages%>
      - PORT_HTTP=<%-config.portHttp.pages%>
      - PORT=<%-config.port.pages%>
    ports:
      - '80:<%-config.portHttp.pages%>'
      - '443:<%-config.port.pages%>'
  portal_dev:
    extends: portal
    environment:
      - NODE_ENV=development
    volumes: <%-config.volumes%>
  services_dev:
    extends: services
    environment:
      - NODE_ENV=development
    volumes: <%-config.volumes%>
  pages_dev:
    extends: pages
    environment:
      - NODE_ENV=development
    volumes: <%-config.volumes%>
